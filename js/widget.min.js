$(document).ready(function() {
	Widget_JS.initContactFormSimple();
});

var Widget_JS = {
	
	initContactFormSimple : function() {
		$(".contact-form-simple-widget").on('click', function() {
			var btn = $(this);
			
			// already processed
			if (btn.prop('disabled')) {
				return;
			}

			btn.prop("disabled", true);
			var frm = btn.parent().parent('form');
			var data = $(frm).serializeArray();
			data.push({token: frm.attr('sid')});
			
			time = new Date();
			time_parts = time.toLocaleTimeString('en-us',{timeZoneName:'short'}).split(' ');
			data.push({name: 'localetimestamp', value:time.valueOf()});
			data.push({name: 'localtimezone', value:time_parts[2]});
			
			$.ajax({
				  type: "POST",
				  url: "/widgets/contactform/church",
				  data: data,
				  success: function(data) {
					    if (data.success && data.data.success) {
							$('input', frm).prop("disabled", true);
							$('textarea', frm).prop("disabled", true);
							$('select', frm).prop("disabled", true);
							btn.text('Message sent. Thank you!');
							alert('Thank you!  Your message has been submitted!');
					    }
					    else {
							btn.removeAttr('disabled');
							if (data.data.message) {
								alert("Failed to send your message. Please try again later.");
							}
							else {
								alert(data.data.message);
							}
					    }
					},
				fail : function(data) {
					btn.removeAttr('disabled');
					alert( "Unable to send inquiry at this time." );
				},
				error: function(req, status, err) {
					alert('Unable to submit inquiry (error ' + status + ')');
				},
				dataType: 'json'
			});
			
		});
	}
}